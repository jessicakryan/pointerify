<html>
    <head>
        <title>Dragster</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

        <link rel="stylesheet" href="./reset.css"/>
        <link rel="stylesheet" href="./style.css"/>

        <style>
            .pointer {
                position: absolute;
                border-radius: 999px;
                height: 30px;
                width: 30px;
                background: rgba(255, 0, 0, .5);
                transition: transform 300ms;
                transform: scale(0);
            }

            .pointer__shown {
                transform: scale(1);
            }

            .pointer__virtual {
                background: rgba(0, 0, 255, .5);
            }

            .pointer__mouse {
                background: rgba(0, 255, 0, .5);
            }

            .pointer__inertial {
                transform: rgba(0, 255, 0, .25);
            }
         </style>
    </head>
    <body>
        <div id="sandbox">
            Lorem upsum sit dolor
        </div>

        <script src="../dist/dragster.js"></script>
        <script>
            const sb = document.getElementById('sandbox');
            const drg = dragster(sb, {
                behavior: {
                    // allowAxis: 'x'
                },
                physics: {
                    // friction: 0.05
                }
            });

            function renderPointer(state) {
                const el = document.createElement('div');

                el.style.left = (state.multiplierX * 100).toString() + '%';
                el.style.top = (state.multiplierY * 100).toString() + '%';

                el.id = state.id;
                el.className = 'pointer';

                if (state.isMousePointer) {
                    el.classList.add('pointer__mouse');
                } else if (state.isTouchPointer) {
                    el.classList.add('pointer__touch');
                } else if (state.isVirtualPointer) {
                    el.classList.add('pointer__virtual');
                }

                sb.appendChild(el);

                requestAnimationFrame(() => el.classList.add('pointer__shown'));
            }

            function movePointer(state) {
                const el = document.getElementById(state.id);

                el.style.left = (state.multiplierX * 100).toString() + '%';
                el.style.top = (state.multiplierY * 100).toString() + '%';
            }

            function flickPointer(state) {
                const el = document.getElementById(state.id);

                el.classList.add('pointer__inertial');
            }

            function killPointer(state) {
                const el = document.getElementById(state.id);

                el.classList.remove('pointer__shown');

                el.addEventListener('transitionend', e => {
                    if (e.target === el && e.propertyName === 'transform') sb.removeChild(el);
                });
            }

            sb.addEventListener('pointerDown', ({detail}) => renderPointer(detail));

            sb.addEventListener('pointerDrag', ({detail}) => movePointer(detail));

            window.addEventListener('pointerUp', ({detail}) => flickPointer(detail));

            window.addEventListener('pointerStop', ({detail}) => killPointer(detail));
        </script>
    </body>
</html>